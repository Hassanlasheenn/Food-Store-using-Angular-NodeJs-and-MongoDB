{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { Subject, takeUntil } from 'rxjs';\nimport { Order } from 'src/app/shared/models/Order';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/cart.service\";\nimport * as i2 from \"src/app/services/user.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"ngx-toastr\";\nimport * as i5 from \"src/app/services/order.service\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../../components/title/title.component\";\nimport * as i9 from \"../../components/notfound/notfound.component\";\nimport * as i10 from \"../../components/text-input/text-input.component\";\nimport * as i11 from \"../../components/order-items-list/order-items-list.component\";\nimport * as i12 from \"../../components/map/map.component\";\nfunction CheckoutPageComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 2)(2, \"div\", 3);\n    i0.ɵɵelement(3, \"app-title\", 4);\n    i0.ɵɵelementStart(4, \"form\", 5);\n    i0.ɵɵelement(5, \"text-input\", 6)(6, \"text-input\", 7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"order-items-list\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 9);\n    i0.ɵɵelement(9, \"app-title\", 10)(10, \"map\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 11)(12, \"div\", 12)(13, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function CheckoutPageComponent_ng_container_1_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.createOrder());\n    });\n    i0.ɵɵtext(14, \"Go To Payment\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.checkoutForm);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"control\", ctx_r0.fc.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"control\", ctx_r0.fc.address);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"order\", ctx_r0.order);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"order\", ctx_r0.order);\n  }\n}\nexport let CheckoutPageComponent = /*#__PURE__*/(() => {\n  class CheckoutPageComponent {\n    get fc() {\n      return this.checkoutForm.controls;\n    }\n    constructor(_cartService, _userService, _fb, _toastrService, _orderService, _router) {\n      this._cartService = _cartService;\n      this._userService = _userService;\n      this._fb = _fb;\n      this._toastrService = _toastrService;\n      this._orderService = _orderService;\n      this._router = _router;\n      this._destroy$ = new Subject();\n      this.order = new Order();\n      this.getCart();\n    }\n    ngOnInit() {\n      this.initForm();\n    }\n    initForm() {\n      let {\n        name,\n        address\n      } = this._userService.currentUser;\n      this.checkoutForm = this._fb.group({\n        name: [name, Validators.required],\n        address: [address, Validators.required]\n      });\n    }\n    createOrder() {\n      if (this.checkoutForm?.invalid) {\n        this._toastrService.warning('Please fill the inputs', 'Invalid Inputs');\n        return;\n      }\n      if (!this.order.addressLatLng) {\n        this._toastrService.warning('Please select your location on the map', 'Location');\n        return;\n      }\n      this.order.name = this.fc.name.value;\n      this.order.address = this.fc.address.value;\n      this._orderService.create(this.order).pipe(takeUntil(this._destroy$)).subscribe({\n        next: () => {\n          this._toastrService.success('Order is created successfully');\n          this._router.navigateByUrl('/payment');\n        },\n        error: err => {\n          this._toastrService.error(err.error, 'Cart');\n        }\n      });\n    }\n    getCart() {\n      const cart = this._cartService.getCart();\n      this.order.items = cart.items;\n      this.order.totalPrice = cart.totalPrice;\n    }\n    ngOnDestroy() {\n      this._destroy$.next();\n      this._destroy$.complete();\n    }\n    static {\n      this.ɵfac = function CheckoutPageComponent_Factory(t) {\n        return new (t || CheckoutPageComponent)(i0.ɵɵdirectiveInject(i1.CartService), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.ToastrService), i0.ɵɵdirectiveInject(i5.OrderService), i0.ɵɵdirectiveInject(i6.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CheckoutPageComponent,\n        selectors: [[\"app-checkout-page\"]],\n        decls: 2,\n        vars: 2,\n        consts: [[\"notFoundMessage\", \"Add Items to order!\", \"resetLinkText\", \"Go to HomePage\", 3, \"isVisible\"], [4, \"ngIf\"], [1, \"container\"], [1, \"content\"], [\"title\", \"Checkout\"], [3, \"formGroup\"], [\"label\", \"Name\", 3, \"control\"], [\"label\", \"Address\", 3, \"control\"], [3, \"order\"], [1, \"map\"], [\"title\", \"Choose your address on Map\"], [1, \"buttons-container\"], [1, \"buttons\"], [3, \"click\"]],\n        template: function CheckoutPageComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelement(0, \"app-notfound\", 0);\n            i0.ɵɵtemplate(1, CheckoutPageComponent_ng_container_1_Template, 15, 5, \"ng-container\", 1);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"isVisible\", !ctx.order || !ctx.order.items.length);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.order.items.length);\n          }\n        },\n        dependencies: [i7.NgIf, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i8.TitleComponent, i9.NotfoundComponent, i10.TextInputComponent, i11.OrderItemsListComponent, i12.MapComponent],\n        styles: [\".container[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-wrap:wrap;margin:0 2rem 6rem;justify-content:center}.content[_ngcontent-%COMP%]{width:35rem;margin-right:3rem}.content[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{display:flex;flex-direction:column}form[_ngcontent-%COMP%]{width:100%}.buttons-container[_ngcontent-%COMP%]{flex-basis:100%;display:flex;justify-content:center}.buttons[_ngcontent-%COMP%]{margin:2rem;width:35rem}button[_ngcontent-%COMP%]{color:#fff;background-color:#e72929;width:100%;height:3rem;opacity:.8;font-size:1.3rem;border:none;border-radius:.5rem;box-shadow:2px 2px 2px 2px gray}button[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}\"]\n      });\n    }\n  }\n  return CheckoutPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}